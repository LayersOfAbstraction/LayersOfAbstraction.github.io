<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Console Commander</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
			<!-- other content of the head element goes here -->
			
			<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/styles/default.min.css">
			<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/csharp.min.js" integrity="sha512-HAlTwK5Ouxm/PgaQV9e3FeQngOyTpvWAZZiyyTNoqUXBl4GIr4tCH+N5RfEPy1TBkFY07wDBKhSlYcS9WVJBNA==" crossorigin="anonymous"></script>
			<!-- <script src="../assets/js/node_modules/highlight.js/lib/highlight.js"></script> -->
			<script src="../assets/js/cshtml-razor.js"></script>
			<script>
				hljs.registerLanguage('cshtml-razor', window.hljsDefineCshtmlRazor);
				hljs.initHighlightingOnLoad();
			</script>
			
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">
				<!-- Header -->
					<header id="header">
						<a class="logo">Blogs</a>
					</header>
				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li class="active"><a href="../#index.html">Home</a></li>						
							<li class="active"><a href="#footer">Contact</a></li>						
						</ul>
						<ul class="icons">							
							<li><a href="https://www.linkedin.com/in/jordan-nash-87b042173/" title="Linked In" class="icon brands fa-linkedin"><span class="label">linked In</span></a></li>
							<li><a href="https://github.com/LayersOfAbstraction/" title="Github" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">
						<header>										
							<h2><a href="https://github.com/LayersOfAbstraction/Pitcher">How to retrieve data from different in DataTables with ASP.NET MVC Core 2.2</a></h2>
						</header>
						<!-- Posts -->
						<div id="projects">
							<section class="posts">
								<article>
									<h1>Intro</h1>
									<p>Completed demo code here.  
										<a href="https://github.com/LayersOfAbstraction/DTEditorLeftJoinSample.git">https://github.com/LayersOfAbstraction/DTEditorLeftJoinSample.git</a></p>																		
									<p> You could use a Entity Framework to create the UI for CRUD operations but that would mean more code, a 
										performance reduction and not nearly as elegant if you design it yourself.</p>
									<p>DataTables takes the heartache out of that. For example I will show you the code for one controller and view built entirely in Entity Framework Core.
									Don't worry you don't have to memorise all the code in the samples right now especially in EF Core.</p>  
									<!-- <a href="https://github.com/LayersOfAbstraction/Pitcher" class="image fit"><img src="images/greg-rosenke-yQ9slR8E5jM-unsplash.jpg"  alt="Pitcher"/></a> -->
									<br/>
									<h1>The view</h1>
										<pre><code class="cshtml-razor">
@model PaginatedList&lt;Pitcher.Models.Registration&gt;

@{
	ViewData[&quot;Title&quot;] = &quot;Registrations&quot;;
}

&lt;h1&gt;Registrations&lt;/h1&gt;

&lt;p&gt;
	&lt;a asp-action=&quot;Create&quot;&gt;Create New&lt;/a&gt;
&lt;/p&gt;
	
&lt;form asp-action=&quot;Index&quot; method=&quot;get&quot;&gt;
	&lt;div class=&quot;form-actions no-color&quot;&gt;
		&lt;p&gt;
			Find by name: &lt;input type=&quot;text&quot; name=&quot;SearchString&quot; value=&quot;@ViewData[&quot;currentFilter&quot;]&quot; /&gt;
			&lt;input type=&quot;submit&quot; value=&quot;Search&quot; class=&quot;btn btn-primary&quot; /&gt; |
			&lt;a asp-action=&quot;Index&quot;&gt;Back to Full List&lt;/a&gt;
		&lt;/p&gt;
	&lt;/div&gt;
&lt;/form&gt;

&lt;table class=&quot;table table-hover&quot;&gt;
	&lt;thead&gt;
		&lt;tr&gt;
			&lt;th&gt;
				&lt;a asp-action=&quot;Index&quot; asp-route-sortOrder=&quot;@ViewData[&quot;RegDateSortParm&quot;]&quot; asp-route-currentFilter=&quot;@ViewData[&quot;CurrentFilter&quot;]&quot;&gt;RegistrationDate&lt;/a&gt;
			&lt;/th&gt;
			&lt;th&gt;
				@* COPY AND PASTE THIS METHOD CUSTOMIZATION INTO OTHER VIEWS BOUND TO COMPOSITE TABLES. Enables sorting. *@
					&lt;a asp-action=&quot;Index&quot; asp-route-sortOrder=&quot;@ViewData[&quot;FullNameSortParam&quot;]&quot; asp-route-currentFilter=&quot;@ViewData[&quot;CurrentFilter&quot;]&quot;&gt;Full Name&lt;/a&gt;
			&lt;/th&gt;
			&lt;th&gt;
				&lt;a asp-action=&quot;Index&quot; asp-route-sortOrder=&quot;@ViewData[&quot;JobTitleSortParam&quot;]&quot; asp-route-currentFilter=&quot;@ViewData[&quot;CurrentFilter&quot;]&quot;&gt;Job Title&lt;/a&gt;
			&lt;/th&gt;
			&lt;th&gt;&lt;/th&gt;
		&lt;/tr&gt;
	&lt;/thead&gt;
	&lt;tbody&gt;
@foreach (var item in Model) {
		&lt;tr&gt;
			&lt;td&gt;
				@Html.DisplayFor(modelItem =&gt; item.RegistrationDate)
			&lt;/td&gt;
			&lt;td&gt;
				@Html.DisplayFor(modelItem =&gt; item.User.UserFullname)
			&lt;/td&gt;
			&lt;td&gt;
				@Html.DisplayFor(modelItem =&gt; item.Job.JobTitle)
			&lt;/td&gt;
			&lt;td&gt;
				&lt;a asp-action=&quot;Edit&quot; asp-route-id=&quot;@item.ID&quot; button type=&quot;button&quot; class=&quot;btn btn-primary btn-block&quot;&gt;Edit&lt;/a&gt; 
				&lt;a asp-action=&quot;Details&quot; asp-route-id=&quot;@item.ID&quot; button type=&quot;button&quot; class=&quot;btn btn-info btn-block&quot;&gt;Details&lt;/a&gt; 
				&lt;a asp-action=&quot;Delete&quot; asp-route-id=&quot;@item.ID&quot; button type=&quot;button&quot; class=&quot;btn btn-primary btn-block&quot;&gt;Delete&lt;/a&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
}
	&lt;/tbody&gt;
&lt;/table&gt;

@{
	var prevDisabled = !Model.HasPreviousPage ? &quot;disabled&quot; : &quot;&quot;;
	var nextDisabled = !Model.HasNextPage ? &quot;disabled&quot; : &quot;&quot;;
}

&lt;a asp-action=&quot;Index&quot;
	asp-route-sortOrder=&quot;@ViewData[&quot;CurrentSort&quot;]&quot;
	asp-route-pageNumber=&quot;@(Model.PageIndex - 1)&quot;
	asp-route-currentFilter=&quot;@ViewData[&quot;CurrentFilter&quot;]&quot;
	class=&quot;btn btn-secondary @prevDisabled&quot;
	button type=&quot;button&quot;&gt;
	Previous
&lt;/a&gt;
&lt;a asp-action=&quot;Index&quot;
	asp-route-sortOrder=&quot;@ViewData[&quot;CurrentSort&quot;]&quot;
	asp-route-pageNumber=&quot;@(Model.PageIndex + 1)&quot;
	asp-route-currentFilter=&quot;@ViewData[&quot;CurrentFilter&quot;]&quot;
	class=&quot;btn btn-secondary @nextDisabled&quot;
	button type=&quot;button&quot;&gt;
	
	Next
&lt;/a&gt;													
										</code></pre>

									<h1>Controller with Index method</h1>
									<pre><code class="csharp">
public async Task<IActionResult> Index(string sortOrder, string currentFilter, string searchString, int? pageNumber)
{
	ViewData["CurrentSort"] = sortOrder;
	ViewData["FullNameSortParam"] = String.IsNullOrEmpty(sortOrder) ? "fullName_desc" : "";           
	ViewData["JobTitleSortParam"] = sortOrder == "jobTitle" ? "jobTitle_desc" : "jobTitle";
	ViewData["RegDateSortParm"] = sortOrder == "Date" ? "date_desc" : "Date";
	ViewData["CurrentFilter"] = searchString;
	IQueryable <Registration> registrations = _context.Registrations.Include(r => r.Job).Include(r => r.User);

	if (searchString != null)
	{
		pageNumber = 1;
	}
	else
	{
		searchString = currentFilter;
	}

	if (!String.IsNullOrEmpty(searchString))
	{
		registrations = registrations.Where(r => r.User.ToString().Contains(searchString)
							|| r.Job.ToString().Contains(searchString));
	}
	switch (sortOrder)
	{
		case "fullName_desc":
			registrations = registrations.OrderByDescending(r => r.User);
			break;
		case "jobTitle_desc":
			registrations = registrations.OrderByDescending(r => r.Job);
			break;
		case "Date":
		registrations = registrations.OrderBy(r => r.RegistrationDate);
			break;
		case "date_desc":
			registrations = registrations.OrderByDescending(r => r.RegistrationDate);
			break;
		case "jobTitle":
			registrations = registrations.OrderBy(r => r.User);
			break;
		//By default FullName is in ascending order when entity is loaded. 
		default:
			registrations = registrations.OrderBy(r => r.Job);
			break;
	}
	int pageSize = 20;
	return View(await  PaginatedList<Registration>.CreateAsync(registrations.AsNoTracking(), pageNumber ?? 1, pageSize));
}
									</code></pre>
									<p>Now I will show you what the UI looks like when I compile the code.</p>
									<a class="image fit"><img src="../images/DTLeftJoins/demo1.gif"  /></a>
									<p>Now if we write the code in DataTables Editor in the Index method for the same controller and the view, it will be much shorter. I will show you what it would look like if we run that.</p>
									<a class="image fit"><img src="../images/DTLeftJoins/demo2.gif"  /></a> 
									<br/>
									<p>Obviously there is heaps more functionality in the UI, the code (which I will show later) is cleaner too. Let's replicate this in a new project. I will do this on Windows 10. You should be able to run and Entity Framework Core on Linux too as .NET Core is open source though if you do Mac then you will have to use
									Docker to install SQL Server which this tutorial sadly does not cover.</p>
									<br/>
									<h1>Download .NetCore</h1>
									<p>Make sure you have downloaded .NET Core SDK 2.2.</p>
									<p> I would advise you do NOT do this using Visual Studio Code as even Microsoft does not bother to generate EF Core objects in MVC such as Views/Controllers using VS Code. Make sure you have downloaded .NET Core SDK
									2.2.</p> 
									<p><a href="https://dotnet.microsoft.com/download/dotnet-core">https://dotnet.microsoft.com/download/dotnet-core</a></p>									
									<h1>Create app in Visual Studio 2019</h1>
									<p>
										Microsoft's ASP.NET Core team use Visual Studio for MVC tutorials with EF Core. So let‚Äôs first open Visual Studio 2019 and create ASP.NET Core WebApplication Template. You can always play around with this app in VS Code later if you want once you complete it.
									</p>											
										<p><a class="image fit"><img src="../images/DTLeftJoins/VSNavigateToFolder.png"/></a></p>
									<br/>
									<p>Make sure you have selected 2.2, have no authentication and have configured for HTTPS.</p>		
									<p><a class="image fit"><img src="../images/DTLeftJoins/CreateNewASP.NETCoreWebApp.png"/></a></p>
									<p>
										After that create the project. We will now create a Recipe database 3 different models, Recipe, RecipeIngredient and Ingredient. Create each of these classes in the model folder.
									</p>
									<p>
										We will now create a Recipe database 3 different models, Recipe, RecipeIngredient and Ingredient.										
									</p>
									<h1>Recipe</h1>
									<pre><code class="csharp">using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace DTEditorLeftJoinSample.Models
{
	public class Recipe
	{
		public int ID { get; set; } 
		
		public string Title {get;set;}
		public string Descriptions {get;set;}
		public string Directions {get;set;} 

		public ICollection<RecipeIngredient> RecipeIngredients {get;set;}    
	}
}
</code></pre>
<h1>RecipeIngredient</h1>
<pre><code class="csharp">
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace DTEditorLeftJoinSample.Models
{
	public class RecipeIngredient
	{
		public int ID {get;set;}

		[Display(Name = "Recipe ID")]
		public int RecipeID { get; set; }

		[Display(Name = "Ingredient ID")]
		public int IngredientID { get; set; }
	
		public int quantity {get;set;}        
		public Recipe Recipe {get;set;}
		public Ingredient Ingredient {get;set;}
	}
}
									</code></pre>
									<h1>Create Ingredient class</h1>
									<pre><code class="csharp">
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace DTEditorLeftJoinSample.Models
{
	public class Ingredient
	{
		public int ID {get;set;}
		[Display(Name = "Ingredient Name")]
		public string IngredientName {get;set;}

		public ICollection<RecipeIngredient> RecipeIngredient {get;set;}    
	}
}										
									</code></pre>
									<p>
										Create the connection string in appsettings.json then copy and paste this connection string there.
									</p>
									<h1>Insert connection string into appsettings.json</h1>									<h1>RecipeIngredient</h1>
									<pre><code class="json">
{
	"ConnectionStrings": {
		"DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=RecipeDB;Trusted_Connection=True;MultipleActiveResultSets=true"
	},
	"Logging": {
		"LogLevel": {
		"Default": "Warning"
		}
	},
	"AllowedHosts": "*"
}										  
									</code></pre>
									<p>Even though we cannot integrate Entity Framework Core directly with DataTables Editor, we can still generate the database via EF Core to use with the library. We will do this by creating the database context class. Create a Data folder and add this class.</p>
									<h1>Create CookingContext</h1>
									<pre><code class="csharp">
using DTEditorLeftJoinSample.Models;
using Microsoft.EntityFrameworkCore;

namespace DTEditorLeftJoinSample.Data
{
	public class CookingContext : DbContext
	{
		public CookingContext(DbContextOptions<CookingContext> options) : base(options)
		{
		}

		public DbSet<Recipe> Recipe { get; set; }
		public DbSet<Ingredient> Ingredient {get;set;}
		public DbSet<RecipeIngredient> RecipeIngredient {get;set;}  
		
		protected override void OnModelCreating(ModelBuilder modelBuilder)
		{
			modelBuilder.Entity<Recipe>().ToTable("tblRecipe");
			modelBuilder.Entity<Ingredient>().ToTable("tblIngredient");
			modelBuilder.Entity<RecipeIngredient>().ToTable("tblRecipeIngredient ");
		}
	}
}																			  
									</code></pre>
									<h1>Register CookingContext as service in Startup.cs</h1>
									<p>Register the CookingContext as a service in Startup.cs using dependency injection where the ConfigureServices method is. You can do that by adding this code to the method. Go to Startup.cs now.</p>
									<pre><code class="csharp">services.AddDbContext<CookingContext>(options => 
options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));									
									</code></pre>
									<p>Now add these statements to the startup file.</p>
									<pre><code class="csharp">using DTEditorLeftJoinSample.Data;
using Microsoft.EntityFrameworkCore;
									</code></pre>
									<h1>Create data seed</h1>
									<p>Now we want to seed the database with test data. This is an optional step but highly beneficial. If it does not work for you, the data can be entered manually. In the Data folder create this file DbInitializer.cs and insert this code. </p>
									<h1>DbInitializer</h1>
									<pre><code class="csharp">using DTEditorLeftJoinSample.Models;
using System;
using System.Linq;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;

namespace DTEditorLeftJoinSample.Data
{
	public static class DbInitializer
	{
		public static void Initialize(CookingContext context)
		{
			context.Database.EnsureCreated();

			// Look for any tables.
			if (context.Recipe.Any() && context.Ingredient.Any() && context.RecipeIngredient.Any())
			{
				return;   // DB has been seeded
			}

			var recipes = new Recipe[]
			{
				new Recipe { Title =" Korean-Style Steak and Noodles with Kimchi", 
				Description="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent sed pharetra neque. Curabitur laoreet eu lectus eu tempus. Fusce elementum arcu ut justo tincidunt mattis.", 
				Direction="1.Cras dignissim in neque a placerat." + "\r\n" + "2.Vestibulum vel vestibulum nunc." + "\r\n" +  "3. Vestibulum interdum est tellus, nec porta metus dignissim ut." 
				},
				new Recipe { Title =" Mashed Potatoes with Savory Thyme Granola", 
				Description=" Etiam aliquam, magna quis lobortis facilisis, lorem eros dignissim nulla, ultrices pulvinar orci lectus a ligula.", 
				Direction="1. Morbi fringilla, justo eu venenatis tempus, mauris leo ultricies magna, et aliquet mi lectus at nisi. Pellentesque vel gravida nunc. Donec in tortor lectus." + "\r\n" + "2.Vestibulum vel vestibulum nunc." + "\r\n" +  "3. Vestibulum interdum est tellus, nec porta metus dignissim ut."},
				new Recipe { Title ="Lemon Garlic Mashed Potatoes", 
				Description="Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.", 
				Direction="1. Maecenas ultricies pretium quam id placerat. Mauris in ligula gravida, vehicula justo faucibus, semper neque." + "\r\n" + "2. Proin sodales aliquam erat quis venenatis." + "\r\n" +  "3. Morbi consectetur libero id sagittis vestibulum."},
				new Recipe { Title =" Sour Cream and Corn Mashers", 
				Description=" Donec posuere pellentesque mi, ac suscipit tellus finibus id.", 
				Direction="1. Nulla placerat erat lorem, eget pellentesque dolor egestas vitae." + "\r\n" + "2. Proin sodales aliquam erat quis venenatis." + "\r\n" +  "3. Suspendisse ac purus lacinia, mollis velit aliquet, finibus arcu. Pellentesque molestie est in diam pulvinar, quis mattis justo volutpat."}
							};
			foreach (Recipe r in recipes)
			{
				context.Recipe.AddRange(r);
			}
			context.SaveChanges();

			var ingredients = new Ingredient[]
			{
				new Ingredient{IngredientName="Duis eu ligula felis"},
				new Ingredient{IngredientName="Donec id mollis arcu"},
				new Ingredient{IngredientName="Cras nec enim luctus"}
			};
			foreach (Ingredient i in ingredients)
			{
				context.Ingredient.AddRange(i);
			}
			context.SaveChanges();

			var recipeIngredients = new RecipeIngredient[]
			{
				new RecipeIngredient{RecipeID=1, IngredientID=1, Quantity =4},
				new RecipeIngredient{RecipeID=2, IngredientID=2, Quantity =3},
				new RecipeIngredient{RecipeID=3, IngredientID=3, Quantity =15}
			};
			
			foreach (RecipeIngredient ri in recipeIngredients)
			{
				context.RecipeIngredient.AddRange(ri);
			}
			context.SaveChanges();             
		}
	}
}																				
									</code></pre>
									<p>We want to get the database context instance from dependency injection container. </p>
									<h1>Call context and seed method</h1>
									<p>Now we call the context instance, the seed method and pass it to the context. Then dispose the context when the seeding is complete. In <b>Program.cs</b> delete any code in the Main method and add this all to the method.</p>
									<h1>Program.cs</h1>
									<pre class="csharp"><code>
public static void Main(string[] args)
{
	var host = CreateWebHostBuilder(args).Build();
	using (var scope = host.Services.CreateScope())
	{
		var services = scope.ServiceProvider;
		try
		{
			var context = services.GetRequiredService<CookingContext>();
			DbInitializer.Initialize(context);
		}
		catch (Exception ex)
		{
			var logger = services.GetRequiredService<ILogger<Program>>();
			logger.LogError(ex, "An error occurred while seeding the database.");
		}
	}

	host.Run();
}
								
									</code></pre>
									<p>Now add these statements</p>
									<pre class="csharp"><code>using DTEditorLeftJoinSample.Data;
using Microsoft.Extensions.DependencyInjection;
									</code></pre>
									<h1>Generate controllers and views with scaffolding engine</h1>
									<p>You could write it all the views in DataTables but it is easier to first auto generate all the CRUD view pages and controllers using Entity Framework Core from the models we made and edit the pages later. We will generate in the scaffolding engine. To that:</p>
									<ul>
										<li>Right-click the <b>Controllers</b> folder in <b>Solution Explorer</b> and select <b>Add > New Scaffolded Item</b></li>
										<li>In the <b>Add Scaffold</b> dialog box:</li>
										<li>Select MVC controller with views, using Entity Framework.</li>
										<li>Click Add. The Add MVC Controller with views, using Entity Framework dialog box appears.</li>
									</ul>
									<a class="image fit"><img src="../images/DTLeftJoins/demo3.gif"  /></a> 
									<ul>
										<li>In <b>Model class</b> select <b>RecipeIngredient.</b></li>
										<li>In <b>Data context class</b> select <b>CookingContext</b>.</li>
										<li>Accept the default <b>CookingController</b> as the name.</li>
										<li>Click <b>Add</b>. The <b>Add MVC Controller with views, using Entity Framework</b> dialog box appears.</li>
									</ul>
									<p>If all is ok then the RecipeIngredient folder generates with all the views, Index, Edit, Details, Delete. Notice in the Controllers folder the new generated controller RecipeIngredientsController.cs.</p>
									<h1>Add RecipeIngredient to navbar</h1>
									<p>We want to be able to go to it from or home page to our _layout.cshtml file. In the second div tag of the header add this list item to the navbar.</p>
									<pre class="cshtml-razor"><code>&lt;li class=&quot;nav-item&quot;&gt;
	&lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;RecipeIngredients&quot; asp-action=&quot;Index&quot;&gt;Recipe Ingredient&lt;/a&gt;
&lt;/li&gt;							</code></pre>
									<p>Press F5. Running the program will generate the database and fill out the tables. If it doesn‚Äôt work please use the SQL Server Object Explorer to fill the tables manually.</p>
									<p>If all goes well you should be able to go directly to the table in the Index view and render the project. But as I said there is no sorting, paging and searching. Not only that, we want to render the RecipeTitle and the IngredientName fields from the other tables not the foreign key IDs! </p>
									<a class="image fit"><img src="../images/DTLeftJoins/demo4.gif"  /></a> 
									<h1>Install DataTables</h1>
									<p>We will have to edit the index and install DataTables Editor server-side libraries to render the related fields from another table. Enter this into the Package Management Console.</p>
									<code>dotnet add package DataTables-Editor-Server</code>
									<p>Our priority is to activate DataTables Editor in the backend controller and then write the code to link the View up to our controller. Remember the backend will use DataTables Editor server-side libraries which are free. </p>
									<p>The front-end DataTables Editor libraries are not free so we won‚Äôt use that. The front end will instead use DataTables which is also free and is compatible with EF Core as long as you aren‚Äôt rendering foreign keys. </p>
									<p>We need to install DataTables into the front end. We just have to reference the javascript and css libraries from DataTables Content Delivery Network. Add the following code to the head in our _Layout.cshtml file.</p>
									<pre><code class="cshtml-razor">&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css&quot;/&gt;</code></pre>
									<p>Go ahead and add this under the footer in the body with all the other scripts.</p>
									<pre><code class="cshtml-razor">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;//cdn.datatables.net/1.10.22/js/jquery.dataTables.js&quot;&gt;&lt;/script&gt;</script></code></pre>
									<h1>Call database directly from Program or Startup</h1>
									<p>Now will need to bypass our RecipeIngredient model and bind our controller directly to the database using DbProviderFactories.RegisterFactory. Remember you can‚Äôt use entity framework with DataTables Editor libraries. Enter this into either your startup.cs or program.cs file. I have chosen to add it to Program.cs.</p>
									<pre><code class="csharp">
// using statement at top of Program.cs
using System.Data.SqlClient;
using System.Data.Common;

// Register the factory in `Main`
DbProviderFactories.RegisterFactory("System.Data.SqlClient", SqlClientFactory.Instance);</code></pre>
									<h1>Bypass model and bind tblRecipeIngredient from controller </h1>
									<pre><code class="csharp">using DataTables;
using Microsoft.Extensions.Configuration;</code></pre>
									<p>Add an IConfiguration object to get the connection string and make sure to set it‚Äôs value is set in the constructor.</p>
									<p>Now go and add this method.</p>
									<p>LeftJoinJobsAndUsersOntoRegistrations()</p>
									<p>I will break it down for you with comments. As you can see I am bypassing Entity Framework models, the database context and instead connecting to the database directly from this method. Make sure your RecipeIngredientsController constructor matches mine and make sure your Index method matches! It will look different.</p>
									<pre><code class="csharp">private readonly IConfiguration _config;
public RecipeIngredientsController(CookingContext context, IConfiguration config)
{
	_context = context;
	_config = config;
}

// GET: RecipeIngredients
public IActionResult Index()
{
	return View();
}

public ActionResult LeftJoinRecipesAndIngredientsOntoRecipeIngredient()
{
	//DECLARE database connection.
	string connectionString = _config.GetConnectionString("DefaultConnection");

	//CREATE database instance.
	using (var db = new Database("sqlserver", connectionString))
	{
		//CREATE Editor instance with starting table.
		var response = new Editor(db, "tblRecipeIngredient")
			.Field(new Field("tblRecipeIngredient.Quantity"))
			.Field(new Field("tblRecipe.Description"))
			.Field(new Field("tblIngredient.IngredientName"))

			//JOIN from tblIngredient column RecipeID linked from tblRecipe column ID
			//and IngredientID linked from tblUser column ID.  
			.LeftJoin("tblRecipe ", " tblRecipe.ID ", "=", " tblRecipeIngredient.RecipeID")
			.LeftJoin("tblIngredient ", " tblIngredient.ID ", "=", " tblRecipeIngredient.IngredientID")
			.Process(HttpContext.Request)
			.Data();
		return Json(response);
	}
}</code></pre>
								<p>Most of the comments should explain what is happening. I am specifying a single table for editing with additional optional data inserted into the table from other tables. i.e I am joining up tables to tblRecipeIngredient by performing an SQL Left Join and then formatting it into a json object which will be passed to the front end. Notice I am creating a DataTables Editor server instance which is free. The front end ones however are not so we will have to use DataTables to fix that in the front-end.</p>
								<p>With the back end code complete let‚Äôs go to our front end.</p>
								<h1>Rewrite view Index in DataTables</h1>
								<p>Go to this directory Views\RecipeIngredients\ and look at the code now in the Index.cshtml.</p>
								<pre><code class="cshtml-razor">@model IEnumerable&lt;DTEditorLeftJoinSample.Models.RecipeIngredient&gt;
@{
	ViewData[&quot;Title&quot;] = &quot;Index&quot;;
}

&lt;h1&gt;Index&lt;/h1&gt;

&lt;p&gt;
	&lt;a asp-action=&quot;Create&quot;&gt;Create New&lt;/a&gt;
&lt;/p&gt;
&lt;table class=&quot;table&quot;&gt;
	&lt;thead&gt;
		&lt;tr&gt;
			&lt;th&gt;
				@Html.DisplayNameFor(model =&gt; model.Quantity)
			&lt;/th&gt;
			&lt;th&gt;
				@Html.DisplayNameFor(model =&gt; model.Recipe)
			&lt;/th&gt;
			&lt;th&gt;
				@Html.DisplayNameFor(model =&gt; model.Ingredient)
			&lt;/th&gt;
			&lt;th&gt;&lt;/th&gt;
		&lt;/tr&gt;
	&lt;/thead&gt;
	&lt;tbody&gt;
@foreach (var item in Model) {
		&lt;tr&gt;
			&lt;td&gt;
				@Html.DisplayFor(modelItem =&gt; item.Quantity)
			&lt;/td&gt;
			&lt;td&gt;
				@Html.DisplayFor(modelItem =&gt; item.Recipe.ID)
			&lt;/td&gt;
			&lt;td&gt;
				@Html.DisplayFor(modelItem =&gt; item.Ingredient.ID)
			&lt;/td&gt;
			&lt;td&gt;
				&lt;a asp-action=&quot;Edit&quot; asp-route-id=&quot;@item.ID&quot;&gt;Edit&lt;/a&gt; |
				&lt;a asp-action=&quot;Details&quot; asp-route-id=&quot;@item.ID&quot;&gt;Details&lt;/a&gt; |
				&lt;a asp-action=&quot;Delete&quot; asp-route-id=&quot;@item.ID&quot;&gt;Delete&lt;/a&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
}
	&lt;/tbody&gt;
&lt;/table&gt;</code></pre>
									<p>We are going to edit most of this. So change the model title to this. </p>
									<pre><code class="cshtml-razor">@model DTEditorLeftJoinSample.Models.RecipeIngredient</code></pre>
									<p>Now change the html table class value ‚Äútable‚Äù to the ID value of recipeIngredientTable.</p>
									<pre><code class="cshtml-razor">&lt;table id=&quot;recipeIngredientTable&quot;&gt;</code></pre>
									<p>Erase all the code in the tbody tag so it looks like this.</p>
									<pre><code>&lt;tbody&gt;&lt;/tbody&gt;</code></pre>
									<p>Now add all this just under the outside of the closing<b> tbody </b>tag. We will break it down as much as possible.</p>
									<pre><code class="cshtml-razor">function renderDT_RowId(data) {
	return data.replace('row_', '');
};
var oTable = $('#recipeIngredientTable').DataTable({
	&quot;ajax&quot;: {
		type: &quot;POST&quot;,
		&quot;url&quot;: &quot;@Url.Action(&quot;LeftJoinRecipesAndIngredientsOntoRecipeIngredient &quot;)&quot;,
		&quot;dataSrc&quot;: function (result) {
			return result.data;
			}
	},
	&quot;columns&quot;: [
		{ &quot;data&quot;: &quot;tblIngredient.IngredientName&quot;},
		{ &quot;data&quot;: &quot;tblRecipe.Description&quot; },
		{ &quot;data&quot;: &quot;tblRecipeIngredient.Quantity&quot; },
		{
			&quot;data&quot;: null,
			&quot;render&quot;: function (value) {
				return '&lt;a href=&quot;/RecipeIngredients/Details/' + renderDT_RowId(value.DT_RowId) + '&quot;button type=&quot;button&quot; class=&quot;btn btn-primary btn-block&quot;&gt;Details&lt;/a&gt; &lt;br&gt; '

					+ '&lt;a href=&quot;/RecipeIngredients/Edit/' + renderDT_RowId(value.DT_RowId) + '&quot;button type=&quot;button&quot; class=&quot;btn btn-info btn-block&quot;&gt;Edit &lt;/a&gt; &lt;br&gt; '


					+ '&lt;a href=&quot;/RecipeIngredients/Delete/' + renderDT_RowId(value.DT_RowId) + '&quot;button type=&quot;button&quot; class=&quot;btn btn-primary btn-block&quot;&gt;Delete&lt;/a&gt;';
			}
		}
		]
});
&lt;/script&gt;
}</code></pre>
									<p>The oTable object contains the ID of our table header which is more maintainable. We can link the header up with the rest of our oTable object. Below that we are making an ajax request to get the name of our controller method which will display all the data we specified in the backend controller.</p>
									<p>When we fire up the program we should be able to tell if our back end is communicating with our frontend.</p>
									<p>In DataTables Editor it is different in regard to getting the primary key and there are some limitations there.</p>
									<p>This would be ok if we used DataTables only but we are not. We need the PK value so ASP knows which record to request from our database when we perform CRUD operations. Notice the renderDT_RowId method where I am calling the buttons that link to the other views Details, Edit and Delete.</p>
									<p>renderDT_RowId(value.DT_RowId)</p>
									<p>That will store each PK value in RAM which also allows us to render the records.</p>
									<p>Now your entire Index.cshtml view should look like this.</p>
									<pre><code class="cshtml-razor">@model DTEditorLeftJoinSample.Models.RecipeIngredient
@{
	ViewData[&quot;Title&quot;] = &quot;Index&quot;;
}

&lt;h1&gt;Index&lt;/h1&gt;

&lt;p&gt;
	&lt;a asp-action=&quot;Create&quot;&gt;Create New&lt;/a&gt;
&lt;/p&gt;
&lt;table id=&quot;recipeIngredientTable&quot;&gt;
	&lt;thead&gt;
		&lt;tr&gt;
			&lt;th&gt;
				@Html.DisplayNameFor(model =&gt; model.Recipe)
			&lt;/th&gt;
			&lt;th&gt;
				@Html.DisplayNameFor(model =&gt; model.Ingredient)
			&lt;/th&gt;
			&lt;th&gt;
				@Html.DisplayNameFor(model =&gt; model.Quantity)
			&lt;/th&gt;
			&lt;th&gt;&lt;/th&gt;
		&lt;/tr&gt;
	&lt;/thead&gt;
	&lt;tbody&gt;&lt;/tbody&gt;
&lt;/table&gt;
@section scripts{
	&lt;script&gt;
	function renderDT_RowId(data) {
		return data.replace('row_', '');
	};
	var oTable = $('#recipeIngredientTable').DataTable({
		&quot;ajax&quot;: {
			type: &quot;POST&quot;,
			&quot;url&quot;: &quot;@Url.Action(&quot;LeftJoinRecipesAndIngredientsOntoRecipeIngredient&quot;)&quot;,
			&quot;dataSrc&quot;: function (result) {
				return result.data;
				}
		},
		&quot;columns&quot;: [
			{ &quot;data&quot;: &quot;tblIngredient.IngredientName&quot;},
			{ &quot;data&quot;: &quot;tblRecipe.Description&quot; },
			{ &quot;data&quot;: &quot;tblRecipeIngredient.Quantity&quot; },
			{ &quot;data&quot;: null,
				&quot;render&quot;: function (value) {
					return '&lt;a href=&quot;/RecipeIngredients/Details/' + renderDT_RowId(value.DT_RowId) + '&quot;button type=&quot;button&quot; class=&quot;btn btn-primary btn-block&quot;&gt;Details&lt;/a&gt; &lt;br&gt; '
						+ '&lt;a href=&quot;/RecipeIngredients/Edit/' + renderDT_RowId(value.DT_RowId) + '&quot;button type=&quot;button&quot; class=&quot;btn btn-info btn-block&quot;&gt;Edit &lt;/a&gt; &lt;br&gt; '
						+ '&lt;a href=&quot;/RecipeIngredients/Delete/' + renderDT_RowId(value.DT_RowId) + '&quot;button type=&quot;button&quot; class=&quot;btn btn-primary btn-block&quot;&gt;Delete&lt;/a&gt;';
				}
			}
			]
	});
	&lt;/script&gt;
}</code></pre>
									<h1>Run it one last time and enjoy üòä </h1>
									<p>Run your program now and go to the Index. It should work perfectly. You can see the power and functionality that DataTables brings. As you can see it has sorting searching and if you put in more records you will even be able to divide it up into multiple pages and decide how many get shown.</p>
									<p>If we did that all in Entity Framework Core the code required would be substantially longer and give us nowhere as much functionality.</p>
									<a class="image fit"><img src="../images/DTLeftJoins/demo5.gif"  /></a> 



									<h1>Credit</h1>
									<p>This problem would not have been solved without the help of Herman Starzhynski who I thank greatly! <a href="https://www.linkedin.com/in/hstarzhynski/?lipi=urn%3Ali%3Apage%3Ad_flagship3_search_srp_top%3ByNuB3tWoS9axywKgVuomGg%3D%3D&licu=urn%3Ali%3Acontrol%3Ad_flagship3_search_srp_top-search_srp_result&lici=%2BxIoAhfqR%2FGIF7YQLL%2BSoQ%3D%3D">https://www.linkedin.com/in/hstarzhynski/?lipi=urn%3Ali%3Apage%3Ad_flagship3_search_srp_top%3ByNuB3tWoS9axywKgVuomGg%3D%3D&licu=urn%3Ali%3Acontrol%3Ad_flagship3_search_srp_top-search_srp_result&lici=%2BxIoAhfqR%2FGIF7YQLL%2BSoQ%3D%3D</a></p>
								</article>					
						</div>								
						<!-- Footer -->
					</div>					
				<!-- Footer -->
					<footer id="footer">						
						<section class="split contact">						
								<h3>Email</h3>
								<p><a href="mailto:jnash51@live.com">jnash51@live.com</a></p>
						</section>
						<section class="split contact">
							<h3>Social</h3>
							<ul class="icons alt">									
								<li><a href="https://www.linkedin.com/in/jordan-nash-87b042173/" title="LinkedIn" class="icon brands alt fa-linkedin"><span class="label">Instagram</span></a></li>
								<li><a href="https://github.com/LayersOfAbstraction" title="Github" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
							</ul>
						</section>
						<section class="split contact">
							<h3>Credits</h3>
							<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, San Francisco, Helvetica Neue, Helvetica, Ubuntu, Roboto, Noto, Segoe UI, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@marcuslenk?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Marcus Lenk"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Marcus Lenk</span></a></p>
							<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@helloquence?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Helloquence"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Helloquence</span></a></p>
							<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@cameronstewart?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Cameron Stewart"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Cameron Stewart</span></a></p>
							<!--NOTE if you add their Pitcher image in app. Credit them in README of Pitcher repository.  <p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@theoperatingsystem?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Olena Shmahalo"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Olena Shmahalo</span></a></p> -->

							<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://www.samnoonan.com.au/" target="_blank" rel="noopener noreferrer" title="Please seek permission to use photos from Sam Noonan"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Sam Noonan</span></a></p>
							<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://www.woodsbagot.com/" target="_blank" rel="noopener noreferrer" title="Please seek permission to use photos from  Woods Bagot"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Woods Bagot</span></a></p>
							<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@greg_rosenke" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Greg Rosenke"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Greg Rosenke</span></a></p>
							
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; Jordan Nash</li><li>Design: <a href="https://html5up.net">https://html5up.net</a></li></ul>						
					</div>

			</div>

		<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>

	</body>
</html>